<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Up</title>
    <style>
        body {
            font-family: Merriweather, sans-serif;
            background-color: #6f8b66;
            color: #4b5747;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        h1 {
            font-size: 50px;
            margin-top: 20px;
        }

        canvas {
            border: 2px solid #fff; 
        }

        #playButton {
            padding: 15px 30px;
            font-size: 24px;
            background-color: #50961a;
            color: black;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }

        #playButton:hover {
            background-color: #f39c12;
        }

        #homePage {
            display: block;
            margin-top: 100px;
        }

        #gamePage {
            display: none;
            position: relative;
        }

        #nextLevelPage {
            display: none;
            margin-top: 100px;
        }
    </style>
</head>
<body>

<!-- Home Page -->
<div id="homePage">
    <h1>Plant up: Click to start playing</h1>
    <button id="playButton" onclick="startGame()">Play</button>
</div>

<!-- Game Page -->
<div id="gamePage">
    <h1>Plant up!</h1>
    <canvas id="gameCanvas" class="canvas-background" width="600" height="470"></canvas>
</div>

<!-- Next Level Page -->
<div id="nextLevelPage">
    <h1>Level Complete!</h1>
    <p>Here are some informational sustainable practices you can learn about and do, before moving on to the next stage.</p>
    <button id="nextLevelButton" onclick="startNextLevel()">Next Level</button>
</div>

<script>
// Function to start the game
function startGame() {
    document.getElementById("homePage").style.display = "none";
    document.getElementById("gamePage").style.display = "block";
    initGame();
}

// Function to start the next level
function startNextLevel() {
    document.getElementById("nextLevelPage").style.display = "none";
    document.getElementById("gamePage").style.display = "block";
    initGameWithMaze();
}

// Define constants for the game
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const tileSize = 40; //
const cols = 20;
const rows = 15;
const speed = 6; // 

let pacmanX = 180, pacmanY = 180;
let seedImage = new Image();
seedImage.src = 'https://img.freepik.com/premium-vector/pixel-art-illustration-coffee-bean-pixelated-coffee-bean-coffee-bean-pixelated-pixel-art_1038602-1029.jpg'; // Replace with the actual path to your seed image

const initialPoints = [
    { x: 100, y: 100 },
    { x: 200, y: 200 },
    { x: 300, y: 300 }
];

const mazePoints = [
    { x: 80, y: 80 },
    { x: 540, y: 70 },
    { x: 60, y: 400 },
    { x: 540, y: 490 },
    { x: 200, y: 250 },
    { x: 400, y: 250 }
];

let collectedPoints = [];
let maze = [];
let level = 1;
let mazeWallImage = new Image();
mazeWallImage.src = 'https://pics.craiyon.com/2023-12-01/pnUsMci_RCmb3UOGuAI69g.webp'; 

// Initialize the game
function initGame() {
    level = 1;
    points = initialPoints;
    document.addEventListener('keydown', movePacman);
    canvas.style.background = 'url("https://pics.craiyon.com/2023-12-01/pnUsMci_RCmb3UOGuAI69g.webp") no-repeat center center'; 
    canvas.style.backgroundSize = 'cover';
    seedImage.onload = drawPacman;
    drawPoints();
}

// Initialize the game with a maze
function initGameWithMaze() {
    level = 2;
    points = mazePoints;
    document.addEventListener('keydown', movePacman);
    canvas.style.background = '#6f8b66';
    seedImage.onload = drawPacman;
    generateMaze();
    drawMaze();
    drawPoints();
}

function resetGame() {
    pacmanX = 180;
    pacmanY = 180;
    collectedPoints = [];
    drawPacman();
    drawPoints();
}

function drawPoints() {
    ctx.fillStyle = "yellow";
    points.forEach(point => {
        if (!collectedPoints.includes(point)) {
            ctx.beginPath();
            ctx.arc(point.x, point.y, tileSize / 4, 0, 2 * Math.PI);
            ctx.closePath();
            ctx.fill();
        }
    });
}
function drawPacman() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (level === 2) drawMaze(); // Draw maze if level 2
    ctx.drawImage(seedImage, pacmanX - tileSize / 2, pacmanY - tileSize / 2, tileSize, tileSize);
    drawPoints();
    checkForCollisions();
}

// Move Pac-Man
function movePacman(event) {
    const step = 10;
    let nextX = pacmanX;
    let nextY = pacmanY;
    switch (event.key) {
        case 'ArrowUp':
            nextY -= step;
        case 'ArrowDown':
            nextY += step;
        case 'ArrowLeft':
            nextX -= step;
        case 'ArrowRight':
            nextX += step;
    }
    if (level === 1 || !isWall(nextX, nextY)) {
        pacmanX = nextX;
        pacmanY = nextY;
    }
    drawPacman();
}

function isWall(x, y) {
    return maze.some(wall => 
        x >= wall.x && x <= wall.x + wall.width &&
        y >= wall.y && y <= wall.y + wall.height
    );
}
function checkForCollisions() {
    points.forEach(point => {
        if (!collectedPoints.includes(point) && 
            Math.abs(pacmanX - point.x) < tileSize / 2 && 
            Math.abs(pacmanY - point.y) < tileSize / 2) {
            collectedPoints.push(point);
            drawPoints();
            if (collectedPoints.length === points.length) {
                document.getElementById("gamePage").style.display = "none";
                document.getElementById("nextLevelPage").style.display = "block";
            }
        }
    });
}

// Generate a simple maze for the next level
function generateMaze() {
    const mazePattern = [
        "11111111111111111111",
        "10000000001100000001",
        "10111111101101111101",
        "10100000100000000101",
        "10101111101111110101",
        "10100000000000100101",
        "10111110111110111101",
        "10000000100010000001",
        "10111111111111111101",
        "10000000000000000001",
        "11111111111111111111",
    ];

    maze = [];
    mazePattern.forEach((row, rowIndex) => {
        row.split('').forEach((cell, colIndex) => {
            if (cell === '0') { 
                maze.push({
                    x: colIndex * tileSize,
                    y: rowIndex * tileSize,
                    width: tileSize,
                    height: tileSize
                });
            }
        });
    });
}

// Draw the maze on the canvas
function drawMaze() {
    ctx.fillStyle = "#6f8b66"; // Sage green background
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    maze.forEach(wall => {
        ctx.drawImage(mazeWallImage, wall.x, wall.y, wall.width, wall.height);
    });
}

</script>

</body>
</html>
